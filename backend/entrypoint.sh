#!/usr/bin/env bash
set -e

# Decode the base64 JSON into the file your app expects
echo "ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAia2Fpa28tcHJvZHVjdCIsCiAgInByaXZhdGVfa2V5X2lkIjogImJmMDczYmI3YjY2OWRkOTI1OTI4MWQ1OGQ1MzYwOWI0M2FiYmU2NGEiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV1d0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktVd2dnU2hBZ0VBQW9JQkFRQ2FIa2oxdStkdVc1MmNcbnFhZTY5am94aUxCYjJFdHp0SFdMbU1FWVFjR2pSbHpZTTY1RmNBalBxODc4aTZHWjF3RjREbWVmc1U3WXduRGFcbnBQeXBLQlY1NEtFVWs3OHFpYnAweTVza0hHWnJiS0dpU2NxNndLMnlzMlRuTjhXK3V6bHJWMU9kMlFOSGRRNWVcbjJRM3hvS3dzUFJVSXgwcGE0NXJhdndLL3VMWnVWZ21NMENaS1NrNmxYMFlJQklCS0YvdVFjOHpPc1ljMWNOeVZcbklTakRQSlAzK1hLcE1zODlPOE1Za0FIbHhlbEF2YkxhbEFzNHEwbVV5T1d0bnBDRjhnZ3VWRUs3QkZkWVlaSDNcbjJPMDFKOFYzei93WXVtclFaU29QY25QcE5pbER0dlFnbit4M3lta3FIbEdFSjRuR0tmZTgyTGx3V0RKZTNFK2VcbnhGczYzOWRWQWdNQkFBRUNnZjlCZUJ3R1I0eElsU0tmS25MV09VTC9SOUdqTW43YTZBNEcveDBIOE9jUk5SSzdcbnhUaUN4dFQzWTBUS2c0WmlrN05NRE5KNFJCbjZlcDcyUXFBU083VGowVWljTlNkQUtzSEtXN1BMNDBTZTNjYkxcbjZnejB5R1VCUkxQWWhSaTdyVXozREdHNDdEYzRZOEYzQ1QyakoxMzhiUFpDaEdaUnRkNVNqbEhjbjlyZmc0UFlcbk12N09RTUdzV2tLdDVrMk5WaHEvV2JCbm05Q2ZkTlBSL1FtNkFtZHV5UXdYM1NZQ0p2WTkyZVRIU1prUTRpVzVcbjVIU3FxbUVKM1gyMHFUMlRHNXV3WjM0Z1NMa2lybzBYQzZOTmVJS29tK0VVejhWMWJROGRBeFJnb05tdEliMCtcbm9lUGM0MFlFTEgzaE5QaVc0Y0RLUFRSS1RuNElZeEhjS0N6ZGZna0NnWUVBdU14US8wanhreWp4cUU3MTVZVDBcbnI2SzJaSmNRZHRmUEc0Z3phdzNDcHorcTRiNVZlaFNKS2pYVDEwNXZ1RjhMd1lTRkxyUytYeDBSR3dGcGdMYmdcblJmU3BvOEJ0SytnTnlLWVBRUnlrZ3hFYk9KUURqRXNYcXlicGNzQ01iWktuRHB5RGxwQXYxSVZUU0VVR1hnM1lcbmVmQzRMUXFmblhmWEF3Z05DYVMzWmdrQ2dZRUExWC9ZWk1seFRadnpYT21HczVuWlhXTDFkdXNDMDhzTE5yQmdcbjFWVFppeW9IL2hPdVJaSHJ3SkRJeTRsZjVlWGIwQjg3djRvZEVOUWdlZUZuTmhobXFXWEdjUUVBUjBtMW9Lay9cbmJPVU9sa0RDekh5ZFVtaVhCR2dTMldhT0lES1RWUWpUb2RWTFptQ21oNlk5TG8yMEpJZEtXSW91eTJ4T252eVZcbkdqY0RtZTBDZ1lCdU5uekFKQkxmZjNYUXVYYng4ZiswbUVoTGFjVUorOStyUGVuY21SSlVpU1l6Q0Q4V1ZoVVFcbk5aWW9QTUZvcGxidWpVaVkrSGJwWnY2Q3FxN3ZjeUlDMXM0dHVWL2k1YjBDdy9jcEVCb1ZpU2hBOEJYRm9DdDNcbmlmZUUxczFwdENNcUZiSnRJNFZETEZqbEt6V0c5cDc2NnRRTkdON2xIVW9BcHRhUHY4c1pjUUtCZ1FDZklidFlcbjVBemZtKzI0d3hienB5aXN3cVhURFRmK1JNa0c2bEJDc2d1ei9wQVdnUFRVUmY5Q2VLZ3hqU005YUNaKzZjak9cbjYxTGV5RDJzbXFValhPeW9Ob1BDbHN4dVZqSmFuY3Y0am9KZzI4UldSa3U4c05oZklITnNOMVNZQ3hwbHR6NkdcbjBVUngrbmdsZzNMMjBBZ0ZjaEdvRE5iMEtMWXhLbks0SjJrM3dRS0JnQnhkRlVMckJTU0ZqVitsMEV2MFdveXRcbkIzQUZ6ZDVaRHF3R1J5bjBKNDBPeTlxaGx6L3NBOEloVE03QStoRGZNYkRmMUdneE96WWJQLy9YUkFMeno1YmxcbjRFVVVFWE1oUG1adW9hMG92T2ZTd1dZeUtvdVZYQ1lLemViSlJzZDIyYnlnVWtnc0FHSEJYb3dKQXkwcjBZRWhcbndjZ1lDNURoS0JaZFNFN2FlUE1aXG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICJjbGllbnRfZW1haWwiOiAiZmlyZWJhc2UtYWRtaW5zZGstY2g4OHBAa2Fpa28tcHJvZHVjdC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTU0NDE1ODg5NjIyNzEwNzYwNjMiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2ZpcmViYXNlLWFkbWluc2RrLWNoODhwJTQwa2Fpa28tcHJvZHVjdC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSIKfQo=" | base64 -d > /app/serviceAccountKey.json

# Hand off to the normal CMD (uvicorn)
exec "$@"
